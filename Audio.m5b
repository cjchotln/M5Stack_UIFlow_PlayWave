{"category":"Audio","color":"#aa7942","blocks":["__Audio_Play","__Audio_Setting","__Audio_Volume"],"jscode":"// Block __Audio_Play\nvar __Audio_Play_json = {\n    \"previousStatement\": null,\n    \"nextStatement\": null,\n    \"message0\": \"%1 %2\",\n    \"args0\": [\n        {\n            \"type\": \"field_label\",\n            \"text\": \"play\"\n        },\n        {\n            \"type\": \"input_value\",\n            \"name\": \"play\"\n        }\n    ],\n    \"colour\": \"#aa7942\"\n};\n\nwindow['Blockly'].Blocks['__Audio_Play'] = {\n    init: function() {\n        this.jsonInit(__Audio_Play_json);\n    }\n};\n\nwindow['Blockly'].Python['__Audio_Play'] = function(block) {\n    var play = Blockly.Python.valueToCode(block, 'play', Blockly.Python.ORDER_NONE);\n    return `wav_player(${play})\ni2s.stop()\ni2s.deinit()` + \"\\n\";\n};\n\n// Block __Audio_Setting\nvar __Audio_Setting_json = {\n    \"previousStatement\": null,\n    \"nextStatement\": null,\n    \"message0\": \"%1\",\n    \"args0\": [\n        {\n            \"type\": \"field_label\",\n            \"text\": \"setting\"\n        }\n    ],\n    \"colour\": \"#aa7942\"\n};\n\nwindow['Blockly'].Blocks['__Audio_Setting'] = {\n    init: function() {\n        this.jsonInit(__Audio_Setting_json);\n    }\n};\n\nwindow['Blockly'].Python['__Audio_Setting'] = function(block) {\n        return `from machine import I2S\nimport os, uos, wave\n\n#initialize the I2S device\ni2s = I2S(  mode = I2S.MODE_MASTER | I2S.MODE_TX | I2S.MODE_DAC_BUILT_IN,\n            rate = 16000,\n            bits = 16,\n            channel_format = I2S.CHANNEL_ONLY_RIGHT,\n            data_format = I2S.FORMAT_I2S_MSB)\n\n#uncomment the following line if you have issues mounting the sd\nuos.sdconfig(uos.SDMODE_SPI,clk=18,mosi=23,miso=19,cs=4)\n\n#create a function to play the wav\ndef wav_player(fname):\n    wav = wave.open(fname)\n    i2s.set_dac_mode(I2S.DAC_RIGHT_EN)\n    i2s.sample_rate(wav.getframerate())\n    i2s.bits(wav.getsampwidth() * 8)\n    i2s.nchannels(wav.getnchannels())\n    #i2s.volume(20)\n\n    while True:\n        data = wav.readframes(1024)\n        if len(data) > 0:\n            i2s.write(data)\n        else:\n            wav.close()\n            break\n\n# Playing WAV audio file\nlcd.clear()\n#lcd.print('working',0,0,0xffffff)\n\ntry:\n    uos.mountsd()\nexcept:\n    #os.mountsd()\n    lcd.print('sd card not mounted',0,50,0xffffff)\n    pass` + \"\\n\";\n};\n\n// Block __Audio_Volume\nvar __Audio_Volume_json = {\n    \"previousStatement\": null,\n    \"nextStatement\": null,\n    \"message0\": \"%1 %2\",\n    \"args0\": [\n        {\n            \"type\": \"field_label\",\n            \"text\": \"volume\"\n        },\n        {\n            \"type\": \"field_number\",\n            \"value\": 0,\n            \"name\": \"volume\"\n        }\n    ],\n    \"colour\": \"#aa7942\"\n};\n\nwindow['Blockly'].Blocks['__Audio_Volume'] = {\n    init: function() {\n        this.jsonInit(__Audio_Volume_json);\n    }\n};\n\nwindow['Blockly'].Python['__Audio_Volume'] = function(block) {\n    var volume = block.getFieldValue('volume');\n    return `i2s.volume(${volume})` + \"\\n\";\n};\n\n","code":{"Play":["window['Blockly'].Python['__Audio_Play'] = function(block) {\n    var play = Blockly.Python.valueToCode(block, 'play', Blockly.Python.ORDER_NONE);\n    return `wav_player(${play})\ni2s.stop()\ni2s.deinit()` + \"\\n\";\n};\n\n","wav_player(${play})\ni2s.stop()\ni2s.deinit()"],"Setting":["window['Blockly'].Python['__Audio_Setting'] = function(block) {\n        return `from machine import I2S\nimport os, uos, wave\n\n#initialize the I2S device\ni2s = I2S(  mode = I2S.MODE_MASTER | I2S.MODE_TX | I2S.MODE_DAC_BUILT_IN,\n            rate = 16000,\n            bits = 16,\n            channel_format = I2S.CHANNEL_ONLY_RIGHT,\n            data_format = I2S.FORMAT_I2S_MSB)\n\n#uncomment the following line if you have issues mounting the sd\nuos.sdconfig(uos.SDMODE_SPI,clk=18,mosi=23,miso=19,cs=4)\n\n#create a function to play the wav\ndef wav_player(fname):\n    wav = wave.open(fname)\n    i2s.set_dac_mode(I2S.DAC_RIGHT_EN)\n    i2s.sample_rate(wav.getframerate())\n    i2s.bits(wav.getsampwidth() * 8)\n    i2s.nchannels(wav.getnchannels())\n    #i2s.volume(20)\n\n    while True:\n        data = wav.readframes(1024)\n        if len(data) > 0:\n            i2s.write(data)\n        else:\n            wav.close()\n            break\n\n# Playing WAV audio file\nlcd.clear()\n#lcd.print('working',0,0,0xffffff)\n\ntry:\n    uos.mountsd()\nexcept:\n    #os.mountsd()\n    lcd.print('sd card not mounted',0,50,0xffffff)\n    pass` + \"\\n\";\n};\n\n","from machine import I2S\nimport os, uos, wave\n\n#initialize the I2S device\ni2s = I2S(  mode = I2S.MODE_MASTER | I2S.MODE_TX | I2S.MODE_DAC_BUILT_IN,\n            rate = 16000,\n            bits = 16,\n            channel_format = I2S.CHANNEL_ONLY_RIGHT,\n            data_format = I2S.FORMAT_I2S_MSB)\n\n#uncomment the following line if you have issues mounting the sd\nuos.sdconfig(uos.SDMODE_SPI,clk=18,mosi=23,miso=19,cs=4)\n\n#create a function to play the wav\ndef wav_player(fname):\n    wav = wave.open(fname)\n    i2s.set_dac_mode(I2S.DAC_RIGHT_EN)\n    i2s.sample_rate(wav.getframerate())\n    i2s.bits(wav.getsampwidth() * 8)\n    i2s.nchannels(wav.getnchannels())\n    #i2s.volume(20)\n\n    while True:\n        data = wav.readframes(1024)\n        if len(data) > 0:\n            i2s.write(data)\n        else:\n            wav.close()\n            break\n\n# Playing WAV audio file\nlcd.clear()\n#lcd.print('working',0,0,0xffffff)\n\ntry:\n    uos.mountsd()\nexcept:\n    #os.mountsd()\n    lcd.print('sd card not mounted',0,50,0xffffff)\n    pass"],"Volume":["window['Blockly'].Python['__Audio_Volume'] = function(block) {\n    var volume = block.getFieldValue('volume');\n    return `i2s.volume(${volume})` + \"\\n\";\n};\n\n","i2s.volume(${volume})"]}}